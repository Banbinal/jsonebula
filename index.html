<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Visual JSON explorer that transforms API responses into interactive knowledge graphs">
  <meta name="author" content="jsonebula">
  <meta property="og:title" content="jsonebula">
  <meta property="og:description" content="Visual JSON explorer that transforms API responses into interactive knowledge graphs">
  <meta property="og:type" content="website">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <title>jsonebula</title>
  <link rel="stylesheet" href="styles/main.css">
  <!-- Cytoscape.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
  <!-- Cytoscape Navigator (minimap) -->
  <script src="https://unpkg.com/cytoscape-navigator@2.0.1/cytoscape-navigator.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/cytoscape-navigator@2.0.1/cytoscape.js-navigator.css">
  <!-- CodeMirror -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/lint.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/lint.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/json-lint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.min.js"></script>
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1 class="logo">jsonebula</h1>
      </div>
      <div class="header-center">
        <div class="query-bar">
          <span class="bar-label">Search</span>
          <div class="query-input-wrapper">
            <input type="text" id="query-input" placeholder='client.status = "active"' autocomplete="off">
            <div class="query-autocomplete hidden" id="query-autocomplete">
              <!-- Autocomplete suggestions rendered here -->
            </div>
          </div>
          <button class="btn btn-icon" id="btn-query-help" title="Query syntax help">?</button>
          <button class="btn btn-icon" id="btn-query-clear" title="Clear query">&times;</button>
        </div>
        <div class="quick-filters" id="quick-filters">
          <span class="bar-label">Filters</span>
          <button class="btn btn-chip" data-filter="mapped" title="Show only mapped entities">Mapped</button>
          <button class="btn btn-chip" data-filter="orphans" title="Show disconnected nodes">Orphans</button>
          <button class="btn btn-chip" data-filter="hubs" title="Show highly connected nodes (>5)">Hubs</button>
        </div>
        <div class="call-filters" id="call-filters"></div>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" id="btn-mapping">
          Mapping
          <span class="badge hidden" id="mapping-badge">0</span>
        </button>
        <div class="actions-dropdown" id="actions-dropdown">
          <button class="btn btn-secondary" id="btn-actions">Actions ▾</button>
          <div class="actions-dropdown-menu hidden" id="actions-menu">
            <button class="actions-dropdown-item" id="btn-load-example">Example</button>
            <button class="actions-dropdown-item" id="btn-import">Import</button>
            <button class="actions-dropdown-item" id="btn-export">Export all</button>
            <button class="actions-dropdown-item" id="btn-export-model">Export model</button>
            <div class="actions-dropdown-divider"></div>
            <button class="actions-dropdown-item" id="btn-onboarding">Guided tour</button>
          </div>
        </div>
        <button class="btn btn-icon btn-danger" id="btn-clear-all" title="Clear all data"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg></button>
        <input type="file" id="import-file-input" accept=".json" style="display: none;">
      </div>
    </header>

    <!-- Main Layout -->
    <main class="main-v5">
      <!-- Left Panel: Calls + Editor -->
      <aside class="left-panel" id="left-panel">
        <!-- Collapse Button -->
        <button class="btn-collapse-panel" id="btn-collapse-left" title="Collapse panel">‹</button>

        <!-- Calls Tabs -->
        <div class="calls-section">
          <div class="calls-header">
            <span class="section-title">Calls</span>
            <button class="btn btn-icon" id="btn-add-call" title="Add new call">+</button>
          </div>
          <div class="calls-list" id="calls-list">
            <!-- Call tabs rendered here -->
          </div>
        </div>

        <!-- Resize Handle -->
        <div class="resize-handle-h" id="resize-handle-editor"></div>

        <!-- JSON Editor -->
        <div class="editor-section">
          <div class="editor-header">
            <span class="section-title" id="editor-title">JSON Editor</span>
            <div class="editor-status">
              <span class="status-indicator" id="json-status"></span>
            </div>
          </div>
          <div class="editor-container" id="editor-container">
            <!-- CodeMirror rendered here -->
          </div>
          <div class="editor-actions">
            <button class="btn btn-small" id="btn-format-json">Format</button>
            <button class="btn btn-small" id="btn-copy-json">Copy</button>
            <button class="btn btn-small btn-danger" id="btn-delete-call">Delete Call</button>
          </div>
        </div>
      </aside>

      <!-- Expand Button (visible when collapsed) -->
      <button class="btn-expand-panel hidden" id="btn-expand-left" title="Expand panel">›</button>

      <!-- Center: Graph -->
      <section class="graph-section">
        <div id="graph-container" class="graph-canvas">
          <!-- Graph Stats (above legend) -->
          <div class="graph-stats-overlay" id="graph-stats">
            <span>0 nodes</span>
            <span>0 edges</span>
          </div>
          <!-- Graph Overlay Toolbar (below minimap) -->
          <div class="graph-overlay-toolbar" id="graph-overlay-toolbar">
            <div class="overlay-toolbar-row">
              <button class="btn btn-overlay" id="btn-layout" title="Reorganize layout">&#8693;</button>
              <button class="btn btn-overlay" id="btn-fit" title="Fit to view">&#9635;</button>
              <button class="btn btn-overlay" id="btn-toggle-minimap" title="Toggle minimap">&#9636;</button>
            </div>
            <div class="collapse-controls hidden" id="collapse-controls">
              <span class="collapsed-count" id="collapsed-count">0 collapsed</span>
              <button class="btn btn-overlay btn-overlay-small" id="btn-expand-all" title="Expand all collapsed nodes">&#8645;</button>
            </div>
          </div>
          <!-- Focus Mode Controls -->
          <div class="focus-controls hidden" id="focus-controls">
            <span class="focus-label">Depth:</span>
            <input type="range" id="focus-depth" min="1" max="5" value="2" class="focus-slider">
            <span class="focus-depth-value" id="focus-depth-value">2</span>
            <button class="btn btn-small btn-exit-focus" id="btn-exit-focus">Exit Focus</button>
          </div>
          <!-- Path Finder Controls -->
          <div class="pathfinder-controls hidden" id="pathfinder-controls">
            <span class="pathfinder-label">Path:</span>
            <span class="pathfinder-node" id="pathfinder-from">?</span>
            <span class="pathfinder-arrow">→</span>
            <span class="pathfinder-node" id="pathfinder-to">?</span>
            <button class="btn btn-small btn-find-path" id="btn-find-path" disabled>Find</button>
            <button class="btn btn-small btn-find-path" id="btn-focus-path" disabled title="Hide all nodes not on the path">Focus</button>
            <button class="btn btn-small btn-clear-path" id="btn-clear-path">Clear</button>
          </div>
          <!-- Empty state -->
          <div class="graph-empty" id="graph-empty">
            <div class="empty-content">
              <h2>Paste JSON to explore</h2>
              <p>Paste JSON in the editor on the left, or load an example.</p>
              <button class="btn btn-primary" id="btn-load-example-empty">Load CRM Example</button>
            </div>
          </div>
          <!-- Entity Legend (inside graph container) -->
          <div class="graph-legend" id="graph-legend">
            <!-- Populated dynamically -->
          </div>
          <!-- Minimap Navigator -->
          <div class="graph-minimap" id="graph-minimap"></div>
          <!-- Local processing badge -->
          <div class="local-badge" title="Your data is processed locally and never leaves your device">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/><path d="m9 12 2 2 4-4"/></svg>
          </div>
          <!-- Hidden Nodes Panel (inside graph container) -->
          <div class="hidden-nodes-panel hidden" id="hidden-nodes-panel">
            <div class="hidden-nodes-header">
              <span>Hidden types:</span>
              <button class="btn btn-tiny" id="btn-show-all-hidden">Show all</button>
            </div>
            <div class="hidden-nodes-list" id="hidden-nodes-list">
              <!-- Populated dynamically -->
            </div>
          </div>
        </div>
        <!-- Context Menu (fixed positioning, outside container) -->
        <div class="context-menu" id="graph-context-menu">
          <div class="context-menu-item" data-action="focus">Focus on this</div>
          <div class="context-menu-item" data-action="hide-type">Hide this type</div>
          <div class="context-menu-item" data-action="show-all">Show all types</div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item" data-action="path-from">Set as path start</div>
          <div class="context-menu-item" data-action="path-to">Set as path end</div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item" data-action="expand-children">Expand children</div>
          <div class="context-menu-item" data-action="collapse">Collapse</div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item" data-action="copy-json">Copy JSON</div>
          <div class="context-menu-item" data-action="copy-path">Copy Path</div>
        </div>
      </section>

      <!-- Resize Handle -->
      <div class="resize-handle-v hidden" id="resize-handle-right"></div>

      <!-- Right Panel: Node Details -->
      <aside class="right-panel collapsed" id="right-panel">
        <div class="panel-header">
          <h2>Details</h2>
          <button class="btn btn-icon" id="btn-close-sidebar">&times;</button>
        </div>
        <div class="panel-content" id="node-details">
          <!-- Node details rendered here -->
        </div>
      </aside>
    </main>

    <!-- Mapping Modal -->
    <div class="modal" id="modal-mapping">
      <div class="modal-backdrop"></div>
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h3>Mapping Configuration</h3>
          <button class="btn btn-icon modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="mapping-tabs">
            <button class="mapping-tab active" data-tab="entities">Entities</button>
            <button class="mapping-tab" data-tab="extractions">Extractions</button>
            <button class="mapping-tab" data-tab="relations">Relations</button>
          </div>

          <!-- Entities Tab -->
          <div class="mapping-panel active" id="panel-entities">
            <div class="panel-toolbar">
              <button class="btn btn-small" id="btn-add-entity">+ Add Entity</button>
            </div>
            <div class="panel-list" id="entity-list">
              <!-- Entity cards rendered here -->
            </div>
          </div>

          <!-- Extractions Tab -->
          <div class="mapping-panel" id="panel-extractions">
            <div class="panel-toolbar">
              <label>Call:</label>
              <select id="extraction-call-select">
                <!-- Options populated from calls -->
              </select>
              <button class="btn btn-small" id="btn-add-extraction">+ Add Extraction</button>
            </div>
            <div class="panel-list" id="extraction-list">
              <!-- Extraction configs rendered here -->
            </div>
          </div>

          <!-- Relations Tab -->
          <div class="mapping-panel" id="panel-relations">
            <div class="panel-toolbar">
              <button class="btn btn-small" id="btn-add-relation">+ Add Relation</button>
            </div>
            <div class="panel-list" id="relation-list">
              <!-- Relation configs rendered here -->
            </div>
          </div>

          <!-- Suggestions Section -->
          <div class="suggestions-section hidden" id="suggestions-section">
            <h4>Suggestions</h4>
            <div class="suggestions-list" id="suggestions-list">
              <!-- Suggestions rendered here -->
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary modal-close">Close</button>
          <button class="btn btn-primary" id="btn-apply-mapping">Apply</button>
        </div>
      </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal" id="modal-confirm">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="confirm-title">Confirm</h3>
          <button class="btn btn-icon modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <p id="confirm-message"></p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary modal-close" id="confirm-cancel">Cancel</button>
          <button class="btn btn-primary" id="confirm-ok">Confirm</button>
        </div>
      </div>
    </div>

    <!-- Query Help Modal -->
    <div class="modal" id="modal-query-help">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>Query Syntax</h3>
          <button class="btn btn-icon modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div id="query-help-content"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary modal-close">Close</button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>
  </div>

  <!-- Tooltip -->
  <div class="tooltip" id="global-tooltip"></div>

  <!-- App Scripts -->
  <script type="module" src="src/app.js"></script>
  <script>
    (() => {
      const tip = document.getElementById('global-tooltip');
      let active = null, timer = null;

      document.addEventListener('mouseover', (e) => {
        const el = e.target.closest('[title]');
        if (!el || !el.title) return;
        el.dataset.tip = el.title;
        el.removeAttribute('title');
        clearTimeout(timer);
        timer = setTimeout(() => {
          tip.textContent = el.dataset.tip;
          tip.classList.add('visible');
          const r = el.getBoundingClientRect();
          const tw = tip.offsetWidth;
          const th = tip.offsetHeight;
          let x = r.left + r.width / 2 - tw / 2;
          let y = r.top - th - 6;
          if (y < 4) y = r.bottom + 6;
          if (x < 4) x = 4;
          if (x + tw > window.innerWidth - 4) x = window.innerWidth - tw - 4;
          tip.style.left = x + 'px';
          tip.style.top = y + 'px';
          active = el;
        }, 200);
      });

      document.addEventListener('mouseout', (e) => {
        const el = e.target.closest('[data-tip]');
        if (!el) return;
        clearTimeout(timer);
        el.title = el.dataset.tip;
        delete el.dataset.tip;
        tip.classList.remove('visible');
        active = null;
      });
    })();
  </script>
</body>
</html>
